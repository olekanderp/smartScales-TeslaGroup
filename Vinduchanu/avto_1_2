n}\nvar events = flow.get('events');\nevents.push({\n    \"name\": \"Направление заезда на весы\",\n    \"value\":pl\n});\n\nmsg.payload = pl;\nreturn msg;","outputs":1,"noerr":0,"x":942.8336181640625,"y":151.42859935760498,"wires":[["1d51295e.3a70a7"]]},{"id":"1d51295e.3a70a7","type":"ui_text","z":"85795ec6.1af7b","group":"64001fd.33a1ce","order":4,"width":0,"height":0,"name":"","label":"Напрямок руху","format":"{{msg.payload}}","layout":"col-center","x":1132.666732788086,"y":150.42859935760498,"wires":[]},{"id":"e6b85720.9c3cc8","type":"switch","z":"85795ec6.1af7b","name":"Logging direction","property":"log_direction","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","outputs":1,"x":739.0001678466797,"y":153.4286012649536,"wires":[["f14c9686.2fafe8"]]},{"id":"8bff99d0.8cfc88","type":"function","z":"85795ec6.1af7b","name":"Запис дати з потку від ВесПроц","func":"flow.set('dateFromSerial', Date.now());\n\nreturn msg;","outputs":1,"noerr":0,"x":300.1763916015625,"y":599.1997499465942,"wires":[[]]},{"id":"f783058f.9783c8","type":"inject","z":"85795ec6.1af7b","name":"init","topic":"","payload":"","payloadType":"str","repeat":"1","crontab":"","once":true,"x":80.30524063110352,"y":650.5752992630005,"wires":[["8d94dc08.33002"]]},{"id":"8d94dc08.33002","type":"function","z":"85795ec6.1af7b","name":"Запис дати в NODE-Red","func":"flow.set('dateFromNode',Date.now());\n\nreturn msg;","outputs":1,"noerr":0,"x":273.16239166259766,"y":650.718147277832,"wires":[[]]},{"id":"d070219e.a7657","type":"ui_text","z":"85795ec6.1af7b","group":"a1de8410.9252e8","order":0,"width":0,"height":0,"name":"","label":"Зв'язок","format":"{{msg.payload}}","layout":"row-spread","x":504.60100173950195,"y":644.2473297119141,"wires":[]},{"id":"3f9b1307.62aafc","type":"ui_text","z":"85795ec6.1af7b","group":"a1de8410.9252e8","order":0,"width":0,"height":0,"name":"","label":"Скільки немає зв'язку,с","format":"{{msg.payload}}","layout":"row-spread","x":997.1623458862305,"y":669.0040769577026,"wires":[]},{"id":"1805f17b.04f10f","type":"function","z":"85795ec6.1af7b","name":"Порівняння дат","func":"var eq = flow.get('dateFromSerial');\nvar vt = flow.get('dateFromNode');\nvar sub = (vt - eq);\nif(sub > 2000){\n    msg.payload = \"відключено\";\n}else {\n    msg.payload = \"підключено\";\n}\n\n\n//msg.payload = sub;\nreturn msg;","outputs":1,"noerr":0,"x":287.88680267333984,"y":712.342770576477,"wires":[["d070219e.a7657","8d206159.c7a7b"]]},{"id":"5d3bcf70.24f85","type":"inject","z":"85795ec6.1af7b","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":98.60882568359375,"y":712.4335737228394,"wires":[["1805f17b.04f10f"]]},{"id":"8d206159.c7a7b","type":"function","z":"85795ec6.1af7b","name":"Різниця дат","func":"var eq = flow.get('dateFromSerial');\nvar vt = flow.get('dateFromNode');\nvar sub = (vt - eq);\nmsg.payload = sub/1000;\n\nreturn msg;","outputs":1,"noerr":0,"x":484.0195541381836,"y":715.8611841201782,"wires":[["6cd7bae7.fc7ff4"]]},{"id":"53edfe23.28aa1","type":"inject","z":"85795ec6.1af7b","name":"init","topic":"","payload":"init","payloadType":"str","repeat":"","crontab":"","once":true,"x":84.00000381469727,"y":597.4285764694214,"wires":[["8bff99d0.8cfc88"]]},{"id":"95f24462.16a9b8","type":"debug","z":"85795ec6.1af7b","name":"","active":false,"console":"false","complete":"payload","x":765.5713958740234,"y":649.2857131958008,"wires":[]},{"id":"6cd7bae7.fc7ff4","type":"switch","z":"85795ec6.1af7b","name":"support","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"1","vt":"num"},{"t":"lt","v":"1","vt":"str"}],"checkall":"true","outputs":2,"x":686.6703414916992,"y":717.2798852920532,"wires":[["3f9b1307.62aafc","95f24462.16a9b8"],["887e72e.d10e19"]]},{"id":"887e72e.d10e19","type":"function","z":"85795ec6.1af7b","name":"обнулення, є ЗВ","func":"msg.payload = 0;\n\nreturn msg;","outputs":1,"noerr":0,"x":869.7272720336914,"y":725.2961378097534,"wires":[["3f9b1307.62aafc"]]},{"id":"1259ff5b.6f8a31","type":"function","z":"85795ec6.1af7b","name":"Час, скільки автомобіль на вагах стоїть","func":"var vesa = msg.payload;\n\nif(vesa === 0){\nflow.set('dateVesa_0', Date.now());\n}\n\n\n\nif(vesa > 0){\nflow.set('dateVesa_B0', Date.now());\n}\n\nvar vesa_0 = flow.get('dateVesa_0');\nvar vesa_b0 = flow.get('dateVesa_B0');\n\n\nvar sub_vesa = (vesa_b0 - vesa_0)/1000;\nif( sub_vesa < 0  ){\n    sub_vesa = 0 ;\n}\n\nflow.set('sub_vesa',Math.round(sub_vesa));\nmsg.payload = Math.round(sub_vesa);\n\nreturn msg;","outputs":1,"noerr":0,"x":818.5714569091797,"y":599.9999742507935,"wires":[["b303bf7d.569f4"]]},{"id":"b303bf7d.569f4","type":"ui_text","z":"85795ec6.1af7b","group":"a582aa50.af71c8","order":0,"width":0,"height":0,"name":"","label":"Час тривалості зважування, с","format":"{{msg.payload}}","layout":"row-spread","x":1142.5831298828125,"y":603.1081762313843,"wires":[]},{"id":"545e0c94.eab034","type":"comment","z":"85795ec6.1af7b","name":"Control Status setting","info":"","x":264.28572845458984,"y":540.0000343322754,"wires":[]}]
